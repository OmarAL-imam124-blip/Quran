<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© - v15.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;500;700&display=swap');

        :root {
            --primary: #1a472a;
            --primary-light: #2d5a27;
            --secondary: #2c3e50;
            --accent: #c5a059;
            --bg: #f2f7f5;
            --card-bg: #ffffff;
            --text: #333;
            --border: #dee2e6;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 2rem;
            text-align: center;
            border-bottom: 6px solid var(--accent);
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
        }

        .app-header h1 {
            font-family: 'Amiri', serif;
            font-size: 2.8rem;
            margin-bottom: 0.2rem;
        }

        .container {
            max-width: 1300px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .view {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .view.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 2.5rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2.5rem;
        }

        h2 { color: var(--primary); margin-bottom: 1.5rem; font-size: 1.8rem; display: flex; align-items: center; gap: 12px; }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        .range-selector {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 20px;
            border: 1px solid #eee;
            margin-bottom: 1.5rem;
        }

        .selector-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 0.5fr;
            gap: 15px;
            margin-top: 10px;
            align-items: end;
        }

        .quick-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .template-btn {
            background: #fff;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .template-btn:hover { background: var(--primary); color: #fff; }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
            outline: none;
        }

        .mode-selector {
            display: flex;
            background: #eee;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 1.5rem;
        }
        .mode-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            font-weight: bold;
            transition: 0.3s;
        }
        .mode-option.active { background: var(--primary); color: white; }

        .verse-box {
            background: #fff;
            border: 3px solid var(--primary);
            border-radius: 30px;
            padding: 4rem 2rem;
            text-align: center;
            margin-bottom: 2.5rem;
            box-shadow: 0 10px 20px rgba(26,71,42,0.1);
        }
        .verse-text { font-family: 'Amiri', serif; font-size: 3.5rem; color: var(--primary); line-height: 1.6; margin-bottom: 1.5rem; }

        .tadabbur-box {
            background: #eefdf5;
            padding: 1.5rem;
            border-radius: 15px;
            color: #1a5d3b;
            display: none;
            margin-top: 20px;
            border-right: 6px solid var(--success);
            text-align: right;
            font-size: 1.2rem;
        }

        .tajweed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 2rem;
        }
        .taj-chip {
            background: #f8f9fa;
            border: 1.5px solid #dee2e6;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
        }
        .taj-chip.selected { background: var(--danger); color: white; border-color: var(--danger); }

        .table-container { overflow-x: auto; border-radius: 20px; }
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { padding: 18px; text-align: right; border-bottom: 1px solid #f1f1f1; }
        th { background: #f9fbf9; color: var(--primary); font-weight: 700; }
        tr:hover { background: #f8fcf9; }

        .student-link { color: var(--primary); font-weight: 700; cursor: pointer; text-decoration: none; border-bottom: 1.5px solid var(--accent); }

        .badge { padding: 6px 14px; border-radius: 25px; font-size: 0.85rem; font-weight: 800; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fffbeb; color: #92400e; }

        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(6px);
        }
        .modal-body {
            background: white; border-radius: 30px; width: 95%; max-width: 800px;
            padding: 2.5rem; max-height: 90vh; overflow-y: auto; position: relative;
        }

        #printCertificate {
            width: 1000px; height: 700px; background: white; padding: 60px;
            border: 35px solid var(--primary); position: relative; display: none; margin: 0 auto;
        }

        @media print {
            body * { visibility: hidden; }
            #printCertificate, #printCertificate * { visibility: visible; }
            #printCertificate { position: absolute; left: 0; top: 0; display: block !important; }
        }

        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
            .selector-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header class="app-header no-print">
        <h1>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ <small style="font-size: 1rem; opacity: 0.8;">v15.0</small></h1>
        <p>Ø¨Ø¥Ø´Ø±Ø§Ù Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ù„Ù‚Ø© Ø¹Ù…Ø± Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¥Ù…Ø§Ù…</p>
    </header>

    <div class="container no-print">
        
        <!-- View 1: Main Dashboard -->
        <div id="mainDashboard" class="view active">
            <div class="main-grid">
                <div class="main-column">
                    <div class="card">
                        <h2>ğŸ‘¤ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
                        
                        <div class="range-selector">
                            <label style="font-weight: bold; color: var(--primary);">Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³ÙˆØ± ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ÙŠÙÙ†ØµØ­ Ø¨Ù€ 5-6):</label>
                            <div class="selector-grid">
                                <div>
                                    <label style="font-size: 0.8rem; display: block;">Ù…Ù† Ø³ÙˆØ±Ø©:</label>
                                    <select id="startSurah"></select>
                                </div>
                                <div>
                                    <label style="font-size: 0.8rem; display: block;">Ø¥Ù„Ù‰ Ø³ÙˆØ±Ø©:</label>
                                    <select id="endSurah"></select>
                                </div>
                                <div>
                                    <label style="font-size: 0.8rem; display: block; color: var(--success); font-weight: bold;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</label>
                                    <input type="number" id="questionCount" value="5" min="1" max="10">
                                </div>
                            </div>
                            
                            <div class="quick-templates">
                                <span>Ù†Ù…Ø§Ø°Ø¬ Ø³Ø±ÙŠØ¹Ø©:</span>
                                <button class="template-btn" onclick="applyTemplate(77, 113, 5)">Ø¬Ø²Ø¡ Ø¹Ù…Ù‘ (5Ø³)</button>
                                <button class="template-btn" onclick="applyTemplate(66, 76, 5)">Ø¬Ø²Ø¡ ØªØ¨Ø§Ø±Ùƒ (5Ø³)</button>
                                <button class="template-btn" onclick="applyTemplate(57, 65, 5)">Ø¬Ø²Ø¡ Ù‚Ø¯ Ø³Ù…Ø¹ (5Ø³)</button>
                                <button class="template-btn" onclick="applyTemplate(0, 113, 10)">Ø§Ù„Ù‚Ø±Ø¢Ù† ÙƒØ§Ù…Ù„Ø§Ù‹</button>
                            </div>
                        </div>

                        <div class="mode-selector">
                            <div class="mode-option active" id="modeNormal" onclick="setMode('normal')">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ø§Ù…Ø©</div>
                            <div class="mode-option" id="modeChallenge" onclick="setMode('challenge')">Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª ÙˆØªØ­Ø¯ÙŠ</div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <input type="text" id="studentSearchInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ..." style="flex: 1; padding: 15px; border-radius: 12px; border: 2px solid #eee; font-size: 1.1rem; outline: none;">
                            <button class="btn btn-primary" onclick="startAssessment()">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                        </div>
                    </div>

                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</h2>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-outline btn-sm" onclick="exportDataExcel()">ØªØµØ¯ÙŠØ± CSV</button>
                                <button class="btn btn-outline btn-sm" onclick="backupData()">ğŸ’¾ Ø­ÙØ¸ Ù†Ø³Ø®Ø©</button>
                                <button class="btn btn-outline btn-sm" onclick="document.getElementById('importFile').click()">ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
                                <input type="file" id="importFile" style="display:none" onchange="restoreData(event)">
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="mainResultsTable">
                                <thead>
                                    <tr>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                        <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                        <th>Ø§Ù„Ù†Ø·Ø§Ù‚</th>
                                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsGrid"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="side-column">
                    <div class="card">
                        <h2>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
                        <div id="topStudentsList"></div>
                    </div>
                    <div class="card" style="background: #fffdf5; border: 1px solid #ffeeba;">
                        <h2 style="font-size: 1.3rem;">ğŸ’¡ Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
                        <p id="dailyPedagogicalTip" style="font-style: italic; color: #744210;"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- View 2: Assessment Mode -->
        <div id="assessmentView" class="view">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h2 id="liveStudentName">...</h2>
                        <div id="activeRangeLabel" style="font-size: 0.9rem; color: #666;">...</div>
                    </div>
                    <div id="progressCounter" style="font-weight: bold; color: var(--accent); font-size: 1.4rem;">...</div>
                </div>

                <div class="verse-box">
                    <div id="verseDisplayArea" class="verse-text"></div>
                    <button class="btn btn-outline btn-sm" onclick="toggleTadabbur()">ğŸ’¡ ØªØ¯Ø¨Ø± Ø§Ù„Ù…Ø¹Ù†Ù‰</button>
                    <div id="tadabburTextContent" class="tadabbur-box"></div>
                </div>

                <div style="background: #fdfdfd; padding: 20px; border-radius: 20px; margin-bottom: 2rem; border: 1px dashed #ccc; text-align: center;">
                    <div id="recordingLabel" style="display:none; color: var(--danger); font-weight: bold; margin-bottom: 10px;">ğŸ”´ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©...</div>
                    <button id="recordButton" class="btn btn-danger" onclick="captureAudio()">ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹</button>
                    <button id="previewAudioButton" class="btn btn-secondary" style="display:none" onclick="playCurrentPreview()">â–¶ï¸ Ø§Ø³ØªÙ…Ø§Ø¹</button>
                </div>

                <div class="tajweed-box">
                    <label style="font-weight: bold;">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ¬ÙˆÙŠØ¯ÙŠØ©:</label>
                    <div class="tajweed-grid">
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">ØºÙ†Ø©</div>
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">Ù…Ø¯ÙˆØ¯</div>
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">Ù…Ø®Ø§Ø±Ø¬</div>
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">ÙˆÙ‚Ù</div>
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">Ù‚Ù„Ù‚Ù„Ø©</div>
                        <div class="taj-chip" onclick="this.classList.toggle('selected')">Ø¥Ø®ÙØ§Ø¡</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                    <button class="btn" style="background: var(--success); color: white; height: 70px; font-size: 1.5rem;" onclick="gradeStep(2)">ØµØ­ÙŠØ­ (2)</button>
                    <button class="btn" style="background: var(--warning); color: white; height: 70px; font-size: 1.5rem;" onclick="gradeStep(1)">ØªØ±Ø¯Ø¯ (1)</button>
                    <button class="btn" style="background: var(--danger); color: white; height: 70px; font-size: 1.5rem;" onclick="gradeStep(0)">Ø®Ø·Ø£ (0)</button>
                </div>
            </div>
        </div>

        <!-- View 3: Final Results -->
        <div id="performanceSummaryView" class="view">
            <div class="card" style="text-align: center; padding: 4rem 2rem;">
                <h2 style="justify-content: center; font-size: 2.2rem;">Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                <div style="font-size: 6rem; font-weight: 900; color: var(--primary); margin: 1rem 0;" id="finalScoreBadge">0 / 0</div>
                <div id="finalLevelStatus"></div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
                    <button id="btnCertificate" class="btn btn-accent" style="display:none" onclick="triggerCertificatePrint()">ğŸ“„ Ø´Ù‡Ø§Ø¯Ø© ØªÙÙˆÙ‚</button>
                    <button class="btn btn-success" onclick="shareOnWhatsApp()">ğŸ’¬ Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
                    <button class="btn btn-primary" onclick="saveRecordAndClose()">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Profile Modal -->
    <div id="studentProfileModal" class="modal" onclick="closeProfile(event)">
        <div class="modal-body" onclick="event.stopPropagation()">
            <button style="position: absolute; top: 20px; left: 20px; border: none; background: #eee; width: 40px; height: 40px; border-radius: 50%;" onclick="document.getElementById('studentProfileModal').style.display='none'">âœ•</button>
            <h2 id="profStudentName">Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <div id="studentHistoryTable"></div>
        </div>
    </div>

    <!-- Certificate -->
    <div id="printCertificate">
        <div style="text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
            <p>Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</p>
            <h1 style="font-size: 3.5rem; color: var(--primary); font-family: 'Amiri';">Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ‚Ø§Ù† ÙˆØªÙÙˆÙ‚</h1>
            <p style="font-size: 1.5rem;">ÙŠØ´Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ù…Ø± Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¨Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨:</p>
            <div id="certNameSlot" style="font-size: 3rem; color: var(--accent); font-family: 'Amiri'; border-bottom: 2px dashed var(--primary); width: 80%; margin: 10px auto;">...</div>
            <p style="font-size: 1.5rem;">Ù‚Ø¯ Ø£ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù†Ø·Ø§Ù‚:</p>
            <div id="certRangeSlot" style="font-size: 1.4rem; font-weight: bold; color: #555;">...</div>
            <p style="font-size: 1.5rem;">ÙˆØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©:</p>
            <div id="certScoreSlot" style="font-size: 2.8rem; font-weight: bold;">10 / 10</div>
            <div style="display: flex; justify-content: space-around; margin-top: 30px;">
                <p>ØªØ§Ø±ÙŠØ®: <span id="certDateSlot"></span></p>
                <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…</p>
            </div>
        </div>
    </div>

    <script>
        let storageDB;
        const dbReq = indexedDB.open("QuranComprehensiveV15", 1);
        dbReq.onupgradeneeded = (e) => {
            storageDB = e.target.result;
            if (!storageDB.objectStoreNames.contains("voiceLogs")) storageDB.createObjectStore("voiceLogs", { keyPath: "id" });
        };
        dbReq.onsuccess = (e) => { storageDB = e.target.result; syncDashboard(); };

        const surahs = ["Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©","ÙŠÙˆÙ†Ø³","Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡","Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…","Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©","Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±","ØºØ§ÙØ±","ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰","Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚","Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯","Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†","Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø±ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©","Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±","Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³","Ø§Ù„ØªÙƒÙˆÙŠØ±","Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚","Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚","Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯","Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„","Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†","Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©","Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±","Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„","Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"];

        const comprehensiveBank = [
            // Juz' 30
            { t: "ï´¿Ø¹ÙÙ…Ù‘Ù ÙŠÙØªÙØ³ÙØ§Ø¡ÙÙ„ÙÙˆÙ†Ù * Ø¹ÙÙ†Ù Ø§Ù„Ù†Ù‘ÙØ¨ÙØ¥Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ùï´¾", sidx: 77, s: "Ø§Ù„Ù†Ø¨Ø£", m: "ØªØ³Ø§Ø¤Ù„ Ø§Ù„Ù…Ø´Ø±ÙƒÙŠÙ† Ø¹Ù† ÙŠÙˆÙ… Ø§Ù„Ø¨Ø¹Ø«.", c: false },
            { t: "ï´¿Ø¥ÙØ°ÙØ§ Ø§Ù„Ø´Ù‘ÙÙ…Ù’Ø³Ù ÙƒÙÙˆÙ‘ÙØ±ÙØªÙ’ * ÙˆÙØ¥ÙØ°ÙØ§ Ø§Ù„Ù†Ù‘ÙØ¬ÙÙˆÙ…Ù Ø§Ù†ÙƒÙØ¯ÙØ±ÙØªÙ’ï´¾", sidx: 80, s: "Ø§Ù„ØªÙƒÙˆÙŠØ±", m: "Ø£Ù‡ÙˆØ§Ù„ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© ÙˆØªØºÙŠØ± Ø§Ù„ÙƒÙˆÙ†.", c: false },
            { t: "ï´¿Ø¥ÙØ°ÙØ§ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù Ø§Ù†ÙÙØ·ÙØ±ÙØªÙ’ * ÙˆÙØ¥ÙØ°ÙØ§ Ø§Ù„Ù’ÙƒÙÙˆÙØ§ÙƒÙØ¨Ù Ø§Ù†ØªÙØ«ÙØ±ÙØªÙ’ï´¾", sidx: 81, s: "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", m: "Ù…Ø´Ø§Ù‡Ø¯ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© ÙˆØ§Ù†ÙØ·Ø§Ø± Ø§Ù„Ø³Ù…Ø§Ø¡.", c: false },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù’Ø¥ÙÙ†Ø³ÙØ§Ù†Ù Ù…ÙØ§ ØºÙØ±Ù‘ÙÙƒÙ Ø¨ÙØ±ÙØ¨Ù‘ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØ±ÙÙŠÙ…Ùï´¾", sidx: 81, s: "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", m: "ØªØ°ÙƒÙŠØ± Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø¨ÙØ¶Ù„ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡.", c: true },
            { t: "ï´¿ÙˆÙÙŠÙ’Ù„ÙŒ Ù„Ù‘ÙÙ„Ù’Ù…ÙØ·ÙÙÙ‘ÙÙÙÙŠÙ†Ù * Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¥ÙØ°ÙØ§ Ø§ÙƒÙ’ØªÙØ§Ù„ÙÙˆØ§ï´¾", sidx: 82, s: "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", m: "ØªØ­Ø°ÙŠØ± Ù…Ù† Ø§Ù„ØºØ´ ÙÙŠ Ø§Ù„ÙƒÙŠÙ„ ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†.", c: false },
            { t: "ï´¿Ø¥ÙØ°ÙØ§ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù Ø§Ù†Ø´ÙÙ‚Ù‘ÙØªÙ’ * ÙˆÙØ£ÙØ°ÙÙ†ÙØªÙ’ Ù„ÙØ±ÙØ¨Ù‘ÙÙ‡ÙØ§ ÙˆÙØ­ÙÙ‚Ù‘ÙØªÙ’ï´¾", sidx: 83, s: "Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚", m: "Ø§Ø³ØªØ³Ù„Ø§Ù… Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„Ø£Ù…Ø± Ø±Ø¨Ù‡Ø§ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø©.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù Ø°ÙØ§ØªÙ Ø§Ù„Ù’Ø¨ÙØ±ÙÙˆØ¬Ù * ÙˆÙØ§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ù…ÙÙˆÙ’Ø¹ÙÙˆØ¯Ùï´¾", sidx: 84, s: "Ø§Ù„Ø¨Ø±ÙˆØ¬", m: "Ù‚Ø³Ù… Ø¨Ø§Ù„Ø³Ù…Ø§Ø¡ Ø°Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø²Ù„ Ø§Ù„Ø¹Ø¸ÙŠÙ…Ø©.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù ÙˆÙØ§Ù„Ø·Ù‘ÙØ§Ø±ÙÙ‚Ù * ÙˆÙÙ…ÙØ§ Ø£ÙØ¯Ù’Ø±ÙØ§ÙƒÙ Ù…ÙØ§ Ø§Ù„Ø·Ù‘ÙØ§Ø±ÙÙ‚Ùï´¾", sidx: 85, s: "Ø§Ù„Ø·Ø§Ø±Ù‚", m: "Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„Ø³Ù…Ø§Ø¡ ÙˆØ¨Ø§Ù„Ù†Ø¬Ù… Ø§Ù„Ø«Ø§Ù‚Ø¨.", c: false },
            { t: "ï´¿Ø³ÙØ¨Ù‘ÙØ­Ù Ø§Ø³Ù’Ù…Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø§Ù„Ù’Ø£ÙØ¹Ù’Ù„ÙÙ‰ * Ø§Ù„Ù‘ÙØ°ÙÙŠ Ø®ÙÙ„ÙÙ‚Ù ÙÙØ³ÙÙˆÙ‘ÙÙ‰Ù°ï´¾", sidx: 86, s: "Ø§Ù„Ø£Ø¹Ù„Ù‰", m: "ØªÙ†Ø²ÙŠÙ‡ Ø§Ù„Ù„Ù‡ ÙˆÙˆØµÙ ÙƒÙ…Ø§Ù„ Ø®Ù„Ù‚Ù‡.", c: false },
            { t: "ï´¿Ù‡ÙÙ„Ù’ Ø£ÙØªÙØ§ÙƒÙ Ø­ÙØ¯ÙÙŠØ«Ù Ø§Ù„Ù’ØºÙØ§Ø´ÙÙŠÙØ©Ù * ÙˆÙØ¬ÙÙˆÙ‡ÙŒ ÙŠÙÙˆÙ’Ù…ÙØ¦ÙØ°Ù Ø®ÙØ§Ø´ÙØ¹ÙØ©ÙŒï´¾", sidx: 87, s: "Ø§Ù„ØºØ§Ø´ÙŠØ©", m: "ÙˆØµÙ Ù„Ø£Ù‡ÙˆØ§Ù„ ÙŠÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ù…Ø© ÙˆØ­Ø§Ù„ Ø§Ù„Ù†Ø§Ø³ ÙÙŠÙ‡.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ù’ÙÙØ¬Ù’Ø±Ù * ÙˆÙÙ„ÙÙŠÙØ§Ù„Ù Ø¹ÙØ´Ù’Ø±Ù * ÙˆÙØ§Ù„Ø´Ù‘ÙÙÙ’Ø¹Ù ÙˆÙØ§Ù„Ù’ÙˆÙØªÙ’Ø±Ùï´¾", sidx: 88, s: "Ø§Ù„ÙØ¬Ø±", m: "Ù‚Ø³Ù… Ø¨Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒØ© Ù„Ø¨ÙŠØ§Ù† Ø¹Ø¸Ù…Ø© Ø§Ù„Ø®Ø§Ù„Ù‚.", c: false },
            { t: "ï´¿Ù„ÙØ§ Ø£ÙÙ‚Ù’Ø³ÙÙ…Ù Ø¨ÙÙ‡ÙØ°ÙØ§ Ø§Ù„Ù’Ø¨ÙÙ„ÙØ¯Ù * ÙˆÙØ£ÙÙ†ØªÙ Ø­ÙÙ„Ù‘ÙŒ Ø¨ÙÙ‡ÙØ°ÙØ§ Ø§Ù„Ù’Ø¨ÙÙ„ÙØ¯Ùï´¾", sidx: 89, s: "Ø§Ù„Ø¨Ù„Ø¯", m: "Ù‚Ø³Ù… Ø¨Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© ÙˆØªØ°ÙƒÙŠØ± Ø¨Ù…ÙƒØ§Ø¨Ø¯Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†.", c: true },
            { t: "ï´¿ÙˆÙØ§Ù„Ø´Ù‘ÙÙ…Ù’Ø³Ù ÙˆÙØ¶ÙØ­ÙØ§Ù‡ÙØ§ * ÙˆÙØ§Ù„Ù’Ù‚ÙÙ…ÙØ±Ù Ø¥ÙØ°ÙØ§ ØªÙÙ„ÙØ§Ù‡ÙØ§ï´¾", sidx: 90, s: "Ø§Ù„Ø´Ù…Ø³", m: "Ù‚Ø³Ù… Ø¨Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„ÙƒÙˆÙ†ÙŠØ© Ø¹Ù„Ù‰ ÙÙ„Ø§Ø­ Ù…Ù† Ø²ÙƒÙ‰ Ù†ÙØ³Ù‡.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ù„Ù‘ÙÙŠÙ’Ù„Ù Ø¥ÙØ°ÙØ§ ÙŠÙØºÙ’Ø´ÙÙ‰Ù° * ÙˆÙØ§Ù„Ù†Ù‘ÙÙ‡ÙØ§Ø±Ù Ø¥ÙØ°ÙØ§ ØªÙØ¬ÙÙ„Ù‘ÙÙ‰Ù°ï´¾", sidx: 91, s: "Ø§Ù„Ù„ÙŠÙ„", m: "ØªÙØ§ÙˆØª Ø³Ø¹ÙŠ Ø§Ù„Ù†Ø§Ø³ ÙˆØ¬Ø²Ø§Ø¡ ÙƒÙ„ Ù…Ù†Ù‡Ù….", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ø¶Ù‘ÙØ­ÙÙ‰Ù° * ÙˆÙØ§Ù„Ù„Ù‘ÙÙŠÙ’Ù„Ù Ø¥ÙØ°ÙØ§ Ø³ÙØ¬ÙÙ‰Ù°ï´¾", sidx: 92, s: "Ø§Ù„Ø¶Ø­Ù‰", m: "ØªØ³Ù„ÙŠØ© Ù„Ù„Ù†Ø¨ÙŠ ï·º ÙˆØªØ°ÙƒÙŠØ± Ø¨Ù†Ø¹Ù… Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡.", c: false },
            { t: "ï´¿Ø£ÙÙ„ÙÙ…Ù’ Ù†ÙØ´Ù’Ø±ÙØ­Ù’ Ù„ÙÙƒÙ ØµÙØ¯Ù’Ø±ÙÙƒÙ * ÙˆÙÙˆÙØ¶ÙØ¹Ù’Ù†ÙØ§ Ø¹ÙÙ†ÙƒÙ ÙˆÙØ²Ù’Ø±ÙÙƒÙï´¾", sidx: 93, s: "Ø§Ù„Ø´Ø±Ø­", m: "Ø¨ÙŠØ§Ù† Ù…Ù†Ø© Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø¨Ø´Ø±Ø­ ØµØ¯Ø±Ù‡.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„ØªÙ‘ÙÙŠÙ†Ù ÙˆÙØ§Ù„Ø²Ù‘ÙÙŠÙ’ØªÙÙˆÙ†Ù * ÙˆÙØ·ÙÙˆØ±Ù Ø³ÙÙŠÙ†ÙÙŠÙ†Ùï´¾", sidx: 94, s: "Ø§Ù„ØªÙŠÙ†", m: "Ù‚Ø³Ù… Ø¨Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ù‚Ø¯Ø³Ø© Ø¹Ù„Ù‰ ØªÙƒØ±ÙŠÙ… Ø®Ù„Ù‚ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†.", c: false },
            { t: "ï´¿Ø§Ù‚Ù’Ø±Ø£Ù’ Ø¨ÙØ§Ø³Ù’Ù…Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø§Ù„Ù‘ÙØ°ÙÙŠ Ø®ÙÙ„ÙÙ‚Ù * Ø®ÙÙ„ÙÙ‚Ù Ø§Ù„Ù’Ø¥ÙÙ†Ø³ÙØ§Ù†Ùï´¾", sidx: 95, s: "Ø§Ù„Ø¹Ù„Ù‚", m: "Ø£ÙˆÙ„ Ù…Ø§ Ù†Ø²Ù„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ….", c: false },
            { t: "ï´¿Ø¥ÙÙ†Ù‘ÙØ§ Ø£ÙÙ†Ø²ÙÙ„Ù’Ù†ÙØ§Ù‡Ù ÙÙÙŠ Ù„ÙÙŠÙ’Ù„ÙØ©Ù Ø§Ù„Ù’Ù‚ÙØ¯Ù’Ø±Ùï´¾", sidx: 96, s: "Ø§Ù„Ù‚Ø¯Ø±", m: "ÙØ¶Ù„ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø± ÙˆØ¹Ø¸Ù…Ø© Ù†Ø²ÙˆÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙÙŠÙ‡Ø§.", c: false },

            // Juz' 29
            { t: "ï´¿ØªÙØ¨ÙØ§Ø±ÙÙƒÙ Ø§Ù„Ù‘ÙØ°ÙÙŠ Ø¨ÙÙŠÙØ¯ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰Ù° ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒï´¾", sidx: 66, s: "Ø§Ù„Ù…Ù„Ùƒ", m: "Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰.", c: false },
            { t: "ï´¿Ù† ÙˆØ§Ù„Ù‚Ù„Ù… ÙˆÙ…Ø§ ÙŠØ³Ø·Ø±ÙˆÙ† * Ù…Ø§ Ø£Ù†Øª Ø¨Ù†Ø¹Ù…Ø© Ø±Ø¨Ùƒ Ø¨Ù…Ø¬Ù†ÙˆÙ†ï´¾", sidx: 67, s: "Ø§Ù„Ù‚Ù„Ù…", m: "Ø¯ÙØ§Ø¹ Ø§Ù„Ù„Ù‡ Ø¹Ù† Ù†Ø¨ÙŠÙ‡ ï·º ÙˆØ§Ù„Ø«Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø®Ù„Ù‚Ù‡.", c: false },
            { t: "ï´¿Ø§Ù„Ù’Ø­ÙØ§Ù‚Ù‘ÙØ©Ù * Ù…ÙØ§ Ø§Ù„Ù’Ø­ÙØ§Ù‚Ù‘ÙØ©Ù * ÙˆÙÙ…ÙØ§ Ø£ÙØ¯Ù’Ø±ÙØ§ÙƒÙ Ù…ÙØ§ Ø§Ù„Ù’Ø­ÙØ§Ù‚Ù‘ÙØ©Ùï´¾", sidx: 68, s: "Ø§Ù„Ø­Ø§Ù‚Ø©", m: "Ø§Ù„Ù‚ÙŠØ§Ù…Ø© Ø§Ù„ØªÙŠ ØªØ­Ù‚ ÙÙŠÙ‡Ø§ Ø§Ù„ÙˆØ¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ¹ÙŠØ¯.", c: false },
            { t: "ï´¿Ø³Ø£Ù„ Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø°Ø§Ø¨ ÙˆØ§Ù‚Ø¹ * Ù„Ù„ÙƒØ§ÙØ±ÙŠÙ† Ù„ÙŠØ³ Ù„Ù‡ Ø¯Ø§ÙØ¹ï´¾", sidx: 69, s: "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", m: "Ø§Ø³ØªØ¹Ø¬Ø§Ù„ Ø§Ù„ÙƒÙØ§Ø± Ù„Ù„Ø¹Ø°Ø§Ø¨ ÙˆÙˆØµÙ Ø£Ù‡ÙˆØ§Ù„ Ø§Ù„Ù‚ÙŠØ§Ù…Ø©.", c: false },
            { t: "ï´¿Ø¥Ù†Ø§ Ø£Ø±Ø³Ù„Ù†Ø§ Ù†ÙˆØ­Ø§Ù‹ Ø¥Ù„Ù‰ Ù‚ÙˆÙ…Ù‡ Ø£Ù† Ø£Ù†Ø°Ø± Ù‚ÙˆÙ…Ùƒï´¾", sidx: 70, s: "Ù†ÙˆØ­", m: "Ø¨Ø¯Ø¡ Ù‚ØµØ© Ù†ÙˆØ­ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ¯Ø¹ÙˆØªÙ‡ Ù„Ù‚ÙˆÙ…Ù‡.", c: false },
            { t: "ï´¿Ù‚Ù„ Ø£ÙˆØ­ÙŠ Ø¥Ù„ÙŠ Ø£Ù†Ù‡ Ø§Ø³ØªÙ…Ø¹ Ù†ÙØ± Ù…Ù† Ø§Ù„Ø¬Ù†ï´¾", sidx: 71, s: "Ø§Ù„Ø¬Ù†", m: "Ø¥ÙŠÙ…Ø§Ù† Ù†ÙØ± Ù…Ù† Ø§Ù„Ø¬Ù† Ø¹Ù†Ø¯ Ø³Ù…Ø§Ø¹Ù‡Ù… Ù„Ù„Ù‚Ø±Ø¢Ù†.", c: true },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù’Ù…ÙØ²Ù‘ÙÙ…Ù‘ÙÙ„Ù * Ù‚ÙÙ…Ù Ø§Ù„Ù„Ù‘ÙÙŠÙ’Ù„Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‚ÙÙ„ÙÙŠÙ„Ù‹Ø§ï´¾", sidx: 72, s: "Ø§Ù„Ù…Ø²Ù…Ù„", m: "Ø£Ù…Ø± Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø¨Ø§Ù„Ù‚ÙŠØ§Ù… ÙˆØ§Ù„ØªÙ‡Ø¬Ø¯.", c: false },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù’Ù…ÙØ¯Ù‘ÙØ«Ù‘ÙØ±Ù * Ù‚ÙÙ…Ù’ ÙÙØ£ÙÙ†Ø°ÙØ±Ù’ * ÙˆÙØ±ÙØ¨Ù‘ÙÙƒÙ ÙÙÙƒÙØ¨Ù‘ÙØ±Ù’ï´¾", sidx: 73, s: "Ø§Ù„Ù…Ø¯Ø«Ø±", m: "Ø£Ù…Ø± Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø¨Ø§Ù„ØªØ¨Ù„ÙŠØº ÙˆØ§Ù„Ø¥Ù†Ø°Ø§Ø±.", c: false },
            { t: "ï´¿Ù„ÙØ§ Ø£ÙÙ‚Ù’Ø³ÙÙ…Ù Ø¨ÙÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ù‚ÙÙŠÙØ§Ù…ÙØ©Ù * ÙˆÙÙ„ÙØ§ Ø£ÙÙ‚Ù’Ø³ÙÙ…Ù Ø¨ÙØ§Ù„Ù†Ù‘ÙÙÙ’Ø³Ù Ø§Ù„Ù„Ù‘ÙÙˆÙ‘ÙØ§Ù…ÙØ©Ùï´¾", sidx: 74, s: "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", m: "Ù‚Ø³Ù… Ø¨ÙŠÙˆÙ… Ø§Ù„Ø¨Ø¹Ø« ÙˆØ¨Ø§Ù„Ù†ÙØ³ Ø§Ù„ØªÙŠ ØªÙ„ÙˆÙ… ØµØ§Ø­Ø¨Ù‡Ø§.", c: false },
            { t: "ï´¿Ù‡ÙÙ„Ù’ Ø£ÙØªÙÙ‰Ù° Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¥ÙÙ†Ø³ÙØ§Ù†Ù Ø­ÙÙŠÙ†ÙŒ Ù…Ù‘ÙÙ†Ù Ø§Ù„Ø¯Ù‘ÙÙ‡Ù’Ø±Ùï´¾", sidx: 75, s: "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", m: "ØªØ°ÙƒÙŠØ± Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø¨Ø£ØµÙ„Ù‡ ÙˆØªÙƒØ±ÙŠÙ…Ù‡ Ø¨Ø§Ù„Ù‡Ø¯Ø§ÙŠØ©.", c: false },
            { t: "ï´¿ÙˆÙØ§Ù„Ù’Ù…ÙØ±Ù’Ø³ÙÙ„ÙØ§ØªÙ Ø¹ÙØ±Ù’ÙÙ‹Ø§ * ÙÙØ§Ù„Ù’Ø¹ÙØ§ØµÙÙÙØ§ØªÙ Ø¹ÙØµÙ’ÙÙ‹Ø§ï´¾", sidx: 76, s: "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", m: "Ù‚Ø³Ù… Ø¨Ø§Ù„Ø±ÙŠØ§Ø­ ÙˆØ§Ù„Ù…Ù„Ø§Ø¦ÙƒØ© Ø¹Ù„Ù‰ ØµØ¯Ù‚ Ø§Ù„Ø¨Ø¹Ø«.", c: false },

            // Juz' 28
            { t: "ï´¿Ù‚ÙØ¯Ù’ Ø³ÙÙ…ÙØ¹Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù‚ÙÙˆÙ’Ù„Ù Ø§Ù„Ù‘ÙØªÙÙŠ ØªÙØ¬ÙØ§Ø¯ÙÙ„ÙÙƒÙ ÙÙÙŠ Ø²ÙÙˆÙ’Ø¬ÙÙ‡ÙØ§ï´¾", sidx: 57, s: "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", m: "Ø¨ÙŠØ§Ù† Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ³Ù…Ø§Ø¹Ù‡ Ù„Ø´ÙƒÙˆÙ‰ Ø®ÙˆÙ„Ø© Ø¨Ù†Øª Ø«Ø¹Ù„Ø¨Ø©.", c: false },
            { t: "ï´¿Ø³ÙØ¨Ù‘ÙØ­Ù Ù„ÙÙ„Ù‘ÙÙ‡Ù Ù…ÙØ§ ÙÙÙŠ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙÙ…ÙØ§ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙˆÙÙ‡ÙÙˆÙ Ø§Ù„Ù’Ø¹ÙØ²ÙÙŠØ²Ù Ø§Ù„Ù’Ø­ÙÙƒÙÙŠÙ…Ùï´¾", sidx: 58, s: "Ø§Ù„Ø­Ø´Ø±", m: "ØªØ³Ø¨ÙŠØ­ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ù„Ù„Ù‡ ÙˆØ¨ÙŠØ§Ù† Ù‚ÙˆØªÙ‡ ÙˆØ­ÙƒÙ…ØªÙ‡.", c: false },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ø§ØªÙ‘ÙÙ‚ÙÙˆØ§ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙÙ„Ù’ØªÙÙ†Ø¸ÙØ±Ù’ Ù†ÙÙÙ’Ø³ÙŒ Ù…Ù‘ÙØ§ Ù‚ÙØ¯Ù‘ÙÙ…ÙØªÙ’ Ù„ÙØºÙØ¯Ùï´¾", sidx: 58, s: "Ø§Ù„Ø­Ø´Ø±", m: "Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„ØªÙ‚ÙˆÙ‰ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø³Ø§Ø¨.", c: true },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ø¥ÙØ°ÙØ§ Ù†ÙÙˆØ¯ÙÙŠÙ Ù„ÙÙ„ØµÙ‘ÙÙ„ÙØ§Ø©Ù Ù…ÙÙ† ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙØ©Ùï´¾", sidx: 61, s: "Ø§Ù„Ø¬Ù…Ø¹Ø©", m: "Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„Ø³Ø¹ÙŠ Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØªØ±Ùƒ Ø§Ù„Ø¨ÙŠØ¹.", c: false },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ù„ÙØ§ ØªÙÙ„Ù’Ù‡ÙÙƒÙÙ…Ù’ Ø£ÙÙ…Ù’ÙˆÙØ§Ù„ÙÙƒÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø£ÙÙˆÙ’Ù„ÙØ§Ø¯ÙÙƒÙÙ…Ù’ï´¾", sidx: 62, s: "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", m: "Ø§Ù„ØªØ­Ø°ÙŠØ± Ù…Ù† Ø§Ù„Ø§Ù†Ø´ØºØ§Ù„ Ø¨Ø§Ù„Ø¯Ù†ÙŠØ§ Ø¹Ù† Ø°ÙƒØ± Ø§Ù„Ù„Ù‡.", c: false },
            { t: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙ‘ÙÙ‡ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ØªÙÙˆØ¨ÙÙˆØ§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ØªÙÙˆÙ’Ø¨ÙØ©Ù‹ Ù†Ù‘ÙØµÙÙˆØ­Ù‹Ø§ï´¾", sidx: 65, s: "Ø§Ù„ØªØ­Ø±ÙŠÙ…", m: "Ø¯Ø¹ÙˆØ© Ø§Ù„Ù…Ø¤Ù…Ù†ÙŠÙ† Ù„Ù„ØªÙˆØ¨Ø© Ø§Ù„ØµØ§Ø¯Ù‚Ø© Ù„ØªÙƒÙÙŠØ± Ø§Ù„Ø°Ù†ÙˆØ¨.", c: true },

            // General Samples (Juz 1-27)
            { t: "ï´¿Ø§Ù„Ù… * Ø°ÙÙ„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ù„ÙØ§ Ø±ÙÙŠÙ’Ø¨Ù ÙÙÙŠÙ‡Ù Ù‡ÙØ¯Ù‹Ù‰ Ù„Ù‘ÙÙ„Ù’Ù…ÙØªÙ‘ÙÙ‚ÙÙŠÙ†Ùï´¾", sidx: 1, s: "Ø§Ù„Ø¨Ù‚Ø±Ø©", m: "Ø§Ù„Ù‚Ø±Ø¢Ù† Ù‡Ø¯Ø§ÙŠØ© Ù„Ù„Ù…ØªÙ‚ÙŠÙ†.", j: 1, c: false },
            { t: "ï´¿ÙˆÙØ¥ÙØ°Ù’ Ù‚ÙØ§Ù„Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ù„ÙÙ„Ù’Ù…ÙÙ„ÙØ§Ø¦ÙÙƒÙØ©Ù Ø¥ÙÙ†Ù‘ÙÙŠ Ø¬ÙØ§Ø¹ÙÙ„ÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù Ø®ÙÙ„ÙÙŠÙÙØ©Ù‹ï´¾", sidx: 1, s: "Ø§Ù„Ø¨Ù‚Ø±Ø©", m: "Ø¨Ø¯Ø§ÙŠØ© Ø®Ù„Ù‚ Ø¢Ø¯Ù… Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù….", j: 1, c: true },
            { t: "ï´¿Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø§Ù„Ù‘ÙØ°ÙÙŠ Ø£ÙÙ†Ø²ÙÙ„Ù ÙÙÙŠÙ‡Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù Ù‡ÙØ¯Ù‹Ù‰ Ù„Ù‘ÙÙ„Ù†Ù‘ÙØ§Ø³Ùï´¾", sidx: 1, s: "Ø§Ù„Ø¨Ù‚Ø±Ø©", m: "ÙØ¶Ù„ Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† ÙˆÙ†Ø²ÙˆÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙÙŠÙ‡.", j: 2, c: false },
            { t: "ï´¿Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙ‘Ù Ø§Ù„Ù’Ù‚ÙÙŠÙ‘ÙÙˆÙ…Ùï´¾", sidx: 1, s: "Ø§Ù„Ø¨Ù‚Ø±Ø©", m: "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠØŒ Ø£Ø¹Ø¸Ù… Ø¢ÙŠØ© ÙÙŠ ÙƒØªØ§Ø¨ Ø§Ù„Ù„Ù‡.", j: 3, c: false },
            { t: "ï´¿Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù‘ÙØ°ÙÙŠ Ø£ÙØ³Ù’Ø±ÙÙ‰Ù° Ø¨ÙØ¹ÙØ¨Ù’Ø¯ÙÙ‡Ù Ù„ÙÙŠÙ’Ù„Ù‹Ø§ Ù…Ù‘ÙÙ†Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ø¬ÙØ¯Ù Ø§Ù„Ù’Ø­ÙØ±ÙØ§Ù…Ùï´¾", sidx: 16, s: "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", m: "Ø°ÙƒØ± Ù…Ø¹Ø¬Ø²Ø© Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¹Ø±Ø§Ø¬.", j: 15, c: false },
            { t: "ï´¿Ù‚ÙÙ„Ù’ ÙŠÙØ§ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠÙ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø£ÙØ³Ù’Ø±ÙÙÙÙˆØ§ Ø¹ÙÙ„ÙÙ‰ Ø£ÙÙ†ÙÙØ³ÙÙ‡ÙÙ…Ù’ Ù„ÙØ§ ØªÙÙ‚Ù’Ù†ÙØ·ÙÙˆØ§ï´¾", sidx: 38, s: "Ø§Ù„Ø²Ù…Ø±", m: "Ø³Ø¹Ø© Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ù„Ù„ØªØ§Ø¦Ø¨ÙŠÙ†.", j: 24, c: true }
        ];

        let state = {
            mode: 'normal', student: "", scores: [], mistakes: [], step: 0, 
            activePool: [], voiceBlobs: [], totalQ: 5,
            archive: JSON.parse(localStorage.getItem('v15_archive') || '[]'),
            startS: 0, endS: 113
        };

        let recorder, chunks = [];

        window.onload = () => {
            initSelectors();
            syncDashboard();
        };

        function initSelectors() {
            const startSelect = document.getElementById('startSurah');
            const endSelect = document.getElementById('endSurah');
            surahs.forEach((s, i) => {
                startSelect.innerHTML += `<option value="${i}">${s}</option>`;
                endSelect.innerHTML += `<option value="${i}" ${i===113?'selected':''}>${s}</option>`;
            });
        }

        function applyTemplate(from, to, count) {
            document.getElementById('startSurah').value = from;
            document.getElementById('endSurah').value = to;
            document.getElementById('questionCount').value = count;
        }

        function setMode(m) {
            state.mode = m;
            document.getElementById('modeNormal').className = `mode-option ${m==='normal'?'active':''}`;
            document.getElementById('modeChallenge').className = `mode-option ${m==='challenge'?'active':''}`;
        }

        function startAssessment() {
            const name = document.getElementById('studentSearchInput').value.trim();
            if (!name) return alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨");

            const from = parseInt(document.getElementById('startSurah').value);
            const to = parseInt(document.getElementById('endSurah').value);
            const qCount = parseInt(document.getElementById('questionCount').value);

            let pool = comprehensiveBank.filter(v => v.sidx >= from && v.sidx <= to);
            if (state.mode === 'challenge') pool = pool.filter(v => v.c);

            if (pool.length < 1) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙƒØ§ÙÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø®ØªØ§Ø±. ÙŠØ±Ø¬Ù‰ ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚.");

            state.student = name;
            state.scores = [];
            state.mistakes = [];
            state.step = 0;
            state.totalQ = Math.min(qCount, pool.length);
            state.activePool = pool.sort(() => 0.5 - Math.random()).slice(0, state.totalQ);
            state.startS = from; state.endS = to;

            document.getElementById('liveStudentName').innerText = `Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨: ${name}`;
            document.getElementById('activeRangeLabel').innerText = `Ø§Ù„Ù†Ø·Ø§Ù‚: Ù…Ù† ${surahs[from]} Ø¥Ù„Ù‰ ${surahs[to]}`;
            
            showStep();
            document.getElementById('mainDashboard').classList.remove('active');
            document.getElementById('assessmentView').classList.add('active');
        }

        function showStep() {
            const v = state.activePool[state.step];
            document.getElementById('progressCounter').innerText = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${state.step + 1} / ${state.totalQ}`;
            document.getElementById('verseDisplayArea').innerText = v.t;
            document.getElementById('tadabburTextContent').innerText = v.m;
            document.getElementById('tadabburTextContent').style.display = "none";
            document.querySelectorAll('.taj-chip').forEach(c => c.classList.remove('selected'));
            document.getElementById('previewAudioButton').style.display = "none";
        }

        function toggleTadabbur() {
            const el = document.getElementById('tadabburTextContent');
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        function gradeStep(pts) {
            state.scores.push(pts);
            document.querySelectorAll('.taj-chip.selected').forEach(c => state.mistakes.push(c.innerText));
            state.step++;
            if (state.step < state.totalQ) showStep(); else finish();
        }

        function finish() {
            const total = state.scores.reduce((a,b) => a+b, 0);
            const maxPossible = state.totalQ * 2;
            document.getElementById('finalScoreBadge').innerText = `${total} / ${maxPossible}`;
            const pct = (total / maxPossible) * 100;
            const lvl = pct >= 90 ? "Ù…Ù…ØªØ§Ø²" : pct >= 70 ? "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹" : "ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©";
            document.getElementById('finalLevelStatus').innerHTML = `<span class="badge ${pct >= 90 ? 'badge-success' : 'badge-warning'}">${lvl}</span>`;
            if (pct >= 90) document.getElementById('btnCertificate').style.display = "inline-flex";
            
            document.getElementById('assessmentView').classList.remove('active');
            document.getElementById('performanceSummaryView').classList.add('active');
        }

        function shareOnWhatsApp() {
            const total = state.scores.reduce((a,b) => a+b, 0);
            const max = state.totalQ * 2;
            const text = `Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ³Ù…ÙŠØ¹ ğŸ“–%0AØ§Ù„Ø·Ø§Ù„Ø¨: ${state.student}%0AØ§Ù„Ø¯Ø±Ø¬Ø©: ${total}/${max}%0AØ§Ù„Ù†Ø·Ø§Ù‚: Ù…Ù† ${surahs[state.startS]} Ø¥Ù„Ù‰ ${surahs[state.endS]}%0AØ¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙ‡ ÙˆØ²Ø§Ø¯Ù‡ Ø­Ø±ØµØ§Ù‹.`;
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function backupData() {
            const data = localStorage.getItem('v15_archive');
            const blob = new Blob([data], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Ø³Ø¬Ù„_Ø§Ù„Ø­Ù„Ù‚Ø©_${Date.now()}.json`; a.click();
        }

        function restoreData(e) {
            const reader = new FileReader();
            reader.onload = (event) => { localStorage.setItem('v15_archive', event.target.result); location.reload(); };
            reader.readAsText(e.target.files[0]);
        }

        function saveRecordAndClose() {
            const rid = Date.now();
            const record = {
                id: rid, name: state.student, score: state.scores.reduce((a,b)=>a+b, 0), max: state.totalQ * 2,
                range: `Ù…Ù† ${surahs[state.startS]} Ø¥Ù„Ù‰ ${surahs[state.endS]}`,
                date: new Date().toLocaleDateString('ar-SA'), mistakes: [...new Set(state.mistakes)].join('ØŒ '),
                hasAudio: state.voiceBlobs.length > 0
            };
            state.archive.unshift(record);
            localStorage.setItem('v15_archive', JSON.stringify(state.archive));
            syncDashboard();
            document.getElementById('performanceSummaryView').classList.remove('active');
            document.getElementById('mainDashboard').classList.add('active');
        }

        function syncDashboard() {
            const grid = document.getElementById('resultsGrid');
            grid.innerHTML = '';
            state.archive.slice(0, 15).forEach(res => {
                grid.innerHTML += `<tr><td><span class="student-link" onclick="openProfile('${res.name}')">${res.name}</span></td><td><b>${res.score}/${res.max}</b></td><td>${res.range}</td><td>${res.date}</td><td><button onclick="delRec(${res.id})" style="border:none;background:none;cursor:pointer;">âŒ</button></td></tr>`;
            });
            const top = document.getElementById('topStudentsList');
            const sorted = [...state.archive].sort((a,b) => (b.score/b.max) - (a.score/a.max)).slice(0, 5);
            top.innerHTML = sorted.length ? '' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.';
            sorted.forEach((s, i) => {
                top.innerHTML += `<div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee;"><span>${i+1}. ${s.name}</span><b>${Math.round((s.score/s.max)*100)}%</b></div>`;
            });
            document.getElementById('dailyPedagogicalTip').innerText = "Ø¥Ù†Ù…Ø§ ÙŠØ«Ø¨Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨ÙƒØ«Ø±Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØ§Ù„ØªØ¹Ø§Ù‡Ø¯ØŒ ÙØªØ¹Ø§Ù‡Ø¯Ù‡ Ø¯ÙˆÙ…Ø§Ù‹.";
        }

        function openProfile(name) {
            const hist = state.archive.filter(r => r.name === name);
            const table = document.getElementById('studentHistoryTable');
            table.innerHTML = hist.map(h => `<div style="padding:10px; border:1px solid #eee; border-radius:10px; margin-bottom:5px;"><b>Ø¯Ø±Ø¬Ø©: ${h.score}/${h.max}</b> | ${h.range} | ${h.date}</div>`).join('');
            document.getElementById('profStudentName').innerText = `Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨: ${name}`;
            document.getElementById('studentProfileModal').style.display = 'flex';
        }

        async function captureAudio() {
            const btn = document.getElementById('recordButton');
            if (recorder && recorder.state === "recording") {
                recorder.stop(); btn.innerText = "ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹";
                document.getElementById('recordingLabel').style.display = "none";
            } else {
                try {
                    const str = await navigator.mediaDevices.getUserMedia({ audio: true });
                    recorder = new MediaRecorder(str); chunks = [];
                    recorder.ondataavailable = e => chunks.push(e.data);
                    recorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'audio/webm' });
                        state.voiceBlobs.push(blob);
                        window.tempUrl = URL.createObjectURL(blob);
                        document.getElementById('previewAudioButton').style.display = "inline-flex";
                    };
                    recorder.start(); btn.innerText = "ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù";
                    document.getElementById('recordingLabel').style.display = "block";
                } catch (e) { alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†."); }
            }
        }

        function playCurrentPreview() { if(window.tempUrl) new Audio(window.tempUrl).play(); }

        function triggerCertificatePrint() {
            document.getElementById('certNameSlot').innerText = state.student;
            document.getElementById('certScoreSlot').innerText = `${state.scores.reduce((a,b)=>a+b,0)} / ${state.totalQ * 2}`;
            document.getElementById('certRangeSlot').innerText = document.getElementById('activeRangeLabel').innerText;
            document.getElementById('certDateSlot').innerText = new Date().toLocaleDateString('ar-SA');
            window.print();
        }

        function delRec(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ")) { state.archive = state.archive.filter(r => r.id !== id); localStorage.setItem('v15_archive', JSON.stringify(state.archive)); syncDashboard(); } }
        function closeProfile(e) { if(e.target.className === 'modal') e.target.style.display='none'; }
        function exportDataExcel() {
            let csv = "Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ø¯Ø±Ø¬Ø©,Ø§Ù„Ù†Ø·Ø§Ù‚,Ø§Ù„ØªØ§Ø±ÙŠØ®\n";
            state.archive.forEach(r => csv += `${r.name},${r.score}/${r.max},${r.range},${r.date}\n`);
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv' });
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = "Ø³Ø¬Ù„_Ø§Ù„Ø­Ù„Ù‚Ø©.csv"; link.click();
        }
    </script>
</body>
</html>
